# spring, jpa practice
## jpa 학습내용 정리
  - orm 사용시 엔티티와 연관관계를 설계하는 방법을 익힌다.
  - ManyToMany 관계를 사용하기 보다는 중간 테이블 엔티티를 만들어서 OneToMany, ManyToOne 관계로 변경하자.
  - 가능한 모든 연관관계는 LAZY 로 설정하자. 예상 못하는 N+1 문제가 발생할 수 있기 때문이다.
  - 컬렉션은 필드에서 초기화 하는 것이 안전하다.  
  - 페치조인을 활용하여 쿼리를 최적화 할 수 있다.
  - 컬렉션일 경우 batchSize 옵션이나 dto를 jpql을 사용하여 가져오는 방식으로 페이징을 활용 할 수 있다.
  - 컬렉션 조회시 jpql 을 사용하여 쿼리를 최적화 한다.
    1. distinct 키워드를 사용해서 컬렉션 조회시 중복 id 를 제거할 수 있다.
    2. 컬렉션 페치조인(일대다)은 1개의 컬렉션에 대해서만 사용해야한다.
    3. 단점으로는 페이징을 할 수 없다.
    4. jqpl 페치조인과 페이징을 함께 사용하면 db 에서 처리할 수 없기 때문에 (db 와 객체의 차이 때문) 메모리에서 처리하는데 메모리가 터질 위험이 있다.
  - 페이징과 컬렉션 엔티티를 함께 사용하는 법
    1. ToOne(일대일,다대일) 관계는 모두 페치조인을 사용한다.
    2. 그 후, 컬렉션은 LAZY LOADING 을 활용한다.
    3. 지연로딩 성능 최적화를 위하여 globalBatchSize 를 설정하여 "IN" query 를 더한다.



